{% extends "base.html" %}
{% load static %}
{% load user_extras %}
{% load spam_extras %}

{% block top_includes %}
  <link rel="stylesheet" type="text/css" href="/static/css/institutions.css" />
{% endblock %}

{% block title %}
    <title>TimeStampAddList</title>
{% endblock title %}

{% block content %}
<h3>TimeStamp Add ({{ project_title }})</h3>
<form action "" id="timestamp-form">
    <div class="row form-group">
        <div class="col-xs-12">
            <span class="form-inline">
                <div class="form-group">
                    <div class="input-group">
                        <div class="input-group-addon">Start Date</div>
                        <input id="startDateFilter" type="date" class="form-control" />
                    </div>
                    <div class="input-group">
                    <div class="input-group-addon">End Date</div>
                        <input id="endDateFilter" type="date" class="form-control" />
                    </div>
                </div>
            </span>
        </div>
    </div>
    <div class="row form-group">
        <div class="col-xs-6">
            <span class="form-inline">
                <div class="form-group">
                    <div class="input-group">
                        <div class="input-group-addon">User</div>
                        <select id="userFilterSelect" class="form-control">
                            <option value=""></option>
                        </select>
                    </div>
                </div>
            </span>
        </div>
        <div class="col-xs-6"></div>
    </div>
    <div class="row">
        <div class="col-xs-6">
            <button type="button" class="btn btn-primary" id="applyFiltersButton">Apply</button>&nbsp;
        </div>
        <div class="col-xs-6">
            <a class="btn btn-success" id="btn-verify">Verify</a>
            <a class="btn btn-success" id="btn-addtimestamp">Request Trusted Timestamp</a>
        </div>
    </div>
    <div class="row">
        <font color="red">
            <h4 id="timestamp_errors_spinner"></h4>
        </font>
        <table id="datatables" class="table table-striped table-bordered" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th width="1%"><input type="checkBox" id="addTimestampAllCheck" style="width: 14px; height: 14px;" /></th>
                    <th>FilePath</th>
                    <th>TimestampUpdateUser</th>
                    <th>TimestampUpdateDate</th>
                    <th>Timestamp verification</th>
                </tr>
            </thead>
            <tbody class="list" id="timestamp_error_list">
            {% for provider_error_info in init_project_timestamp_error_list %}
                <tr><td colspan="5"><b>{{ provider_error_info.provider }}</b></td></tr>
                {% for error_info in provider_error_info.error_list %}
                <tr class="addTimestamp">
                    <td width="1%"><input type="checkBox" id="addTimestampCheck" style="width: 14px; height: 14px;" /></td>
                    <td>
                        {{ error_info.file_path }}
                        <input type="hidden" name="provider" id="provider" value="{{ provider_error_info.provider }}" />
                        <input type="hidden" name="file_id" id="file_id" value="{{ error_info.file_id }}" />
                        <input type="hidden" name="file_path" id="file_path" value="{{ error_info.file_path }}" />
                        <input type="hidden" name="project_id" id="project_id" value="{{ error_info.project_id }}" />
                        <input type="hidden" name="version" id="version" value="{{ error_info.version }}" />
                        <input type="hidden" name="file_name" id="file_name" value="{{ error_info.file_name }}" />
                    </td>
                    <td class="operator_user">{{ error_info.operator_user }} ({{ error_info.operator_user_id }})</td>
                    <td class="operator_date">{{ error_info.operator_date }}</td>
                    <td>{{ error_info.verify_result_title }}</td>
                </tr>
                {% endfor %}
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% csrf_token %}
</form>

<script charset="utf-8">
    window.timestampaddUrls = {
        verify: "{% url 'timestampadd:verify' institution_id=institution_id guid=guid %}",
        verifyData: "{% url 'timestampadd:verify_data' institution_id=institution_id guid=guid %}",
        addTimestampData: "{% url 'timestampadd:add_timestamp_data' institution_id=institution_id guid=guid %}",
        addtimestamp: "{% url 'timestampadd:addtimestamp' institution_id=institution_id guid=guid %}"
    };
</script>
<script src={{ '/static/public/js/rdm-timestampadd-page.js' }}></script>
<script src="https://cdn.jsdelivr.net/npm/better-dom@4.0.0/dist/better-dom.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/better-dateinput-polyfill/3.1.3/better-dateinput-polyfill.min.js"></script>
{% endblock content %}
